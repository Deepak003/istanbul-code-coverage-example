({
    fetchBillingDetails : function(component) {
        component.set("v.isLoading", true);
        Promise.all([
            this.fetchPaymentOptions(component), 
            this.fetchInvoices(component), 
            this.fetchInvoicesCount(component)
        ])
        .then($A.getCallback(function(data){
            component.set("v.isLoading", false);    
        })).catch($A.getCallback(function(response){
            component.set("v.isLoading", false);            
        }));
    },    
    fetchPaymentOptions : function(component) {
        const action = component.get("c.getBillingAccountsByUserId"),
            strCustomerId = component.get("v.nucleusId");
        
        action.setParams({ strCustomerId : strCustomerId });
        
        component.set("v.isPaymentOptionLoading", true);
        
        //return this.serverAction(action, component);
        //return Promise.resolve([{"accountId":"1010106568283","address":{"addressId":"1000283968283","transientMode":"false"},"billingAccountType":"paypal","city":"","country":"","dateCreated":"2016-06-06T12:13Z","dateModified":"2016-06-06T12:26Z","defaultBillingAccount":"false","email":"vv.bisht003@hotmail.com","firstName":"vivek","ipAddress":"10.0.0.10","isValidWebPaymentAccount":"false","lastName":"bisht","name":"Vivek Bisht","region":"","source":"CS-AccountManagement","status":"DISABLED","statusReasonCode":"","type_x":"PAYPAL","userId":"1000199568283","zipcode":""},{"accountId":"1010109368283","address":{"addressId":"1000323968283","transientMode":"false"},"billingAccountType":"paypal","city":"","country":"","dateCreated":"2016-09-06T5:39Z","dateModified":"2016-09-06T5:39Z","defaultBillingAccount":"false","email":"621ab429-381b-451b-a255-c10e9aa3928b_SBA_@ea.com","firstName":"","ipAddress":"159.153.217.10","isValidWebPaymentAccount":"false","lastName":"","name":"PAYPAL (621ab429-381b-451b-a255-c10e9aa3928b_SBA_@ea.com)","region":"","source":"ORIGIN-STORE-WEB-US","status":"ACTIVE","statusReasonCode":"","type_x":"PAYPAL","userId":"1000199568283","zipcode":""},{"accountId":"1010113568283","address":{"addressId":"1000377368283","transientMode":"false"},"billingAccountType":"webPayment","city":"","country":"","dateCreated":"2016-12-20T9:17Z","dateModified":"2016-12-20T9:17Z","defaultBillingAccount":"false","email":"vv.bisht003@gmail.com","ipAddress":"10.0.0.10","isValidWebPaymentAccount":"false","name":"","region":"","source":"CS-AccountManagement","status":"ACTIVE","statusReasonCode":"","subType":"CARD","type_x":"BOA_COMPRA","userId":"1000199568283","zipcode":""},{"accountId":"1010120368283","balance":"3230.0","billingAccountType":"VirtualCurrencyWallet","city":"","country":"","currency_x":"_FF","currencyDisplayName":"FIFA Points","currencyName":"_FF","dateCreated":"2017-08-04T10:24Z","dateModified":"2017-08-04T10:24Z","defaultBillingAccount":"false","ipAddress":"1.121.121.121","lowBalanceThreshold":"0.0","name":"tset","notifyLowBalance":"false","region":"","source":"CS-AccountManagement","status":"ACTIVE","statusReasonCode":"","type_x":"VirtualCurrencyWallet","userId":"1000199568283","zipcode":""},{"accountId":"1010140768283","address":{"addressId":"1000569168283","transientMode":"false"},"billingAccountType":"creditCard","cardNumber":"XXXXXXXXXXXX7624","cardType":"VISA","city":"","country":"","cvv2":"","dateCreated":"2017-12-01T7:7Z","dateModified":"2018-08-23T9:3Z","defaultBillingAccount":"true","deleted":"false","expirationMonth":"10","expirationYear":"2020","firstName":"Roger","ipAddress":"10.0.0.10","isTransient":"false","lastName":"John","lastUsed":"2018-03-06T9:58Z","lastUsedForSubs":"","middleName":"","name":"VISA XXXXXXXXXXXX7624","region":"","source":"ORIGIN-STORE-WEB-US","status":"ACTIVE","statusReasonCode":"","type_x":"","userId":"1000199568283","zipcode":""},{"accountId":"1010160168283","balance":"0.0","billingAccountType":"VirtualCurrencyWallet","city":"","country":"","currency_x":"_PG","currencyDisplayName":"Pogo Gems","currencyName":"_PG","dateCreated":"2018-08-01T15:46Z","dateModified":"2018-08-01T15:46Z","defaultBillingAccount":"false","ipAddress":"159.153.130.10","lowBalanceThreshold":"0.0","name":"","notifyLowBalance":"false","region":"","source":"pogo","status":"ACTIVE","statusReasonCode":"","type_x":"VirtualCurrencyWallet","userId":"1000199568283","zipcode":""}])
        return this.serverAction(action, component)
        .then($A.getCallback(function(data){
            component.set("v.isPaymentOptionLoading", false);
            component.set("v.paymentOptionsRaw", data || []);
            return data;
        })).catch($A.getCallback(function(err){
            component.set("v.isPaymentOptionLoading", false);
            throw err;
        }));
    },    
    fetchInvoices : function(component) {
        const action = component.get("c.getInvoicesByUserId");
        var self = this;
        action.setParams({
            strCustomerId: component.get("v.nucleusId"), 
            strPageNumber: component.get("v.invoicePageNumber").toString(), 
            strPageSize : "20",
            isUnassociated : component.get("v.isOrfanSearch"),
            strPurchaseType : component.get("v.invoiceType"),
            strStartDate: component.get("v.startDate"),
            strEndDate: component.get("v.endDate")
        });
        
        component.set("v.isInvoiceLoading", true);
        
        //return this.serverAction(action, component);
        //return Promise.resolve([{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hByURN9","total":"64.94"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-03-06T9:58Z","dateModified":"2018-03-07T18:0Z","invoiceDate":"2018-03-06T9:58Z","invoiceDescription":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","invoiceId":"1010048268283","invoiceNumber":"1010048268283","invoiceOpenAction":"SETTLE","invoiceUuid":"bc52e18e-f70b-473b-aca0-c419ed47ead3","isGift":"false","lineItems":[{"amount":"64.94","crmProductName":"battlefield-1","currencyName":"USD","description":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","discounts":[],"financeId":"1051827","Id":"1010007468283","isMVPLineItem":"false","itemId":"1010007468283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002321","productName":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","projectId":"314478","quantity":"1","subtotal":"59.99","tax":"4.95","taxes":[{"amount":"4.95","rate":"0.0825","taxType":"US_TX"}],"total":"64.94","unitPrice":"59.99"}],"originalInvoiceId":"1010047268283","provider":"CHASE","providerReference":"hByURN9","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"59.99","tax":"4.95","taxAmount":"4.95","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"64.94","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","city":"Hyderabad","country":"IN","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBySlHJ","total":"64.94"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-03-06T9:56Z","dateModified":"2018-03-07T3:21Z","dateSettled":"2018-03-06T17:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-03-06T9:56Z","invoiceDescription":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","invoiceId":"1010047268283","invoiceNumber":"1010047268283","invoiceOpenAction":"SETTLE","invoiceUuid":"6c98b7d0-1df8-4850-b67a-bee3b3170cbc","ipAddress":"159.153.217.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"64.94","crmProductName":"battlefield-1","currencyName":"USD","description":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","discounts":[],"financeId":"1051827","Id":"1010007068283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010007068283","itemType":"SALES","listSubtotal":"59.99","listUnitPrice":"59.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002321","productName":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","projectId":"314478","quantity":"1","refundRequestStatus":"RefundSucceed","revenue":"59.99","shippingStatus":"FULFILLED","subtotal":"59.99","tax":"4.95","taxes":[{"amount":"4.95","rate":"0.0825","taxType":"US_TX"}],"total":"64.94","unitPrice":"59.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBySlHJ","refunds":[{"refundId":"1010048268283"}],"region":"Telangana","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"59.99","subtotalIncludesTax":"false","tax":"4.95","taxAmount":"4.95","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"64.94","transactionType":"DEBIT","userId":"1000199568283","zipcode":"500005"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBxOTqP","total":"25.97"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:14Z","dateModified":"2018-01-24T18:0Z","invoiceDate":"2018-01-23T15:14Z","invoiceDescription":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","invoiceId":"1010003468283","invoiceNumber":"1010003468283","invoiceOpenAction":"SETTLE","invoiceUuid":"2a54fc1d-d42a-4dce-8e64-9f0fb44052e2","isGift":"false","lineItems":[{"amount":"25.97","crmProductName":"battlefield-1","currencyName":"USD","description":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","discounts":[],"financeId":"1051827","Id":"1010002268283","isMVPLineItem":"false","itemId":"1010002268283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002321","productName":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","projectId":"314478","quantity":"1","subtotal":"23.99","tax":"1.98","taxes":[{"amount":"1.98","rate":"0.0825","taxType":"US_TX"}],"total":"25.97","unitPrice":"23.99"}],"originalInvoiceId":"1010000068283","provider":"CHASE","providerReference":"hBxOTqP","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"23.99","tax":"1.98","taxAmount":"1.98","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"25.97","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBxTVBF","total":"32.46"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:14Z","dateModified":"2018-01-24T18:0Z","invoiceDate":"2018-01-23T15:14Z","invoiceDescription":"Star Wars Battlefront II: Standard Edition - PC -  NA & LATAM (Origin)","invoiceId":"1010003868283","invoiceNumber":"1010003868283","invoiceOpenAction":"SETTLE","invoiceUuid":"7e91dc50-f454-4449-a62f-801aac61be45","isGift":"false","lineItems":[{"amount":"32.46","crmProductName":"star-wars-battlefront-ii","currencyName":"USD","description":"Star Wars Battlefront II: Standard Edition - PC -  NA & LATAM (Origin)","discounts":[],"financeId":"1049470","Id":"1010002668283","isMVPLineItem":"false","itemId":"1010002668283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002148","productName":"Star Wars Battlefront II: Standard Edition - PC -  NA & LATAM (Origin)","projectId":"313552","quantity":"1","subtotal":"29.99","tax":"2.47","taxes":[{"amount":"2.47","rate":"0.0825","taxType":"US_TX"}],"total":"32.46","unitPrice":"29.99"}],"originalInvoiceId":"1010000868283","provider":"CHASE","providerReference":"hBxTVBF","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"29.99","tax":"2.47","taxAmount":"2.47","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"32.46","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBxYXMv","total":"32.46"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:14Z","dateModified":"2018-01-24T18:0Z","invoiceDate":"2018-01-23T15:14Z","invoiceDescription":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","invoiceId":"1010004268283","invoiceNumber":"1010004268283","invoiceOpenAction":"SETTLE","invoiceUuid":"e2c4fdf5-c04e-4f29-a70f-cfcfaacf393b","isGift":"false","lineItems":[{"amount":"32.46","crmProductName":"need-for-speed-payback","currencyName":"USD","description":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","discounts":[],"financeId":"1049070","Id":"1010003068283","isMVPLineItem":"false","itemId":"1010003068283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002155","productName":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","projectId":"313663","quantity":"1","subtotal":"29.99","tax":"2.47","taxes":[{"amount":"2.47","rate":"0.0825","taxType":"US_TX"}],"total":"32.46","unitPrice":"29.99"}],"originalInvoiceId":"1010001668283","provider":"CHASE","providerReference":"hBxYXMv","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"29.99","tax":"2.47","taxAmount":"2.47","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"32.46","transactionType":"REFUND","userId":"1000199568283"},{"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:14Z","dateModified":"2018-01-23T15:14Z","invoiceDate":"2018-01-23T15:14Z","invoiceDescription":"A Way Out - PC- NALATAM (Origin)","invoiceId":"1010004468283","invoiceNumber":"1010004468283","invoiceOpenAction":"SETTLE","invoiceUuid":"98b7c4a5-b124-493f-a06d-b13ce3600bcc","isGift":"false","lineItems":[{"amount":"0.00","crmProductName":"a-way-out","currencyName":"USD","description":"A Way Out - PC- NALATAM (Origin)","discounts":[],"financeId":"1064664","Id":"1010003468283","isMVPLineItem":"false","itemId":"1010003468283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002488","productName":"A Way Out - PC- NALATAM (Origin)","projectId":"312479","quantity":"1","subtotal":"0.00","total":"0.00","unitPrice":"0.00"}],"originalInvoiceId":"1010002468283","source":"EADP_CART_INVOICE","status":"Completed","subtotal":"0.00","taxStatus":"NOT_TAXED","taxStrategy":"CHARGE","total":"0.00","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"NUCLEUS","total":"0.00"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:11Z","dateModified":"2018-01-23T15:14Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-23T15:11Z","invoiceDescription":"A Way Out - PC- NALATAM (Origin)","invoiceId":"1010002468283","invoiceNumber":"1010002468283","invoiceOpenAction":"SETTLE","invoiceUuid":"752c0208-4b7a-45bc-9cf4-162e1bd82df9","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"0.00","crmProductName":"a-way-out","currencyName":"USD","description":"A Way Out - PC- NALATAM (Origin)","discounts":[],"financeId":"1064664","Id":"1010001868283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010001868283","itemType":"SALES","listSubtotal":"29.99","listUnitPrice":"29.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002488","productName":"A Way Out - PC- NALATAM (Origin)","projectId":"312479","quantity":"1","revenue":"0.00","shippingStatus":"CANCELED","subtotal":"0.00","tax":"0.00","taxes":[{"amount":"0.00","rate":"0.0825","taxType":"US_TX"}],"total":"0.00","unitPrice":"29.99"}],"locale":"en_US","provider":"NUCLEUS","refunds":[{"refundId":"1010004468283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"0.00","subtotalIncludesTax":"false","tax":"0.00","taxAmount":"0.00","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"0.00","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBxWrH5","total":"32.46"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:10Z","dateModified":"2018-01-24T15:11Z","dateSettled":"2018-01-23T21:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-23T15:10Z","invoiceDescription":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","invoiceId":"1010001668283","invoiceNumber":"1010001668283","invoiceOpenAction":"SETTLE","invoiceUuid":"cafd2d0e-dfdb-4e3d-b2a2-032859c8141a","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"32.46","crmProductName":"need-for-speed-payback","currencyName":"USD","description":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","discounts":[{"amount":"30.00","discountType":"OFFER","promotionRuleId":"Origin.PRO.50.0001749","rate":"0.5001"}],"financeId":"1049070","Id":"1010001268283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010001268283","itemType":"SALES","listSubtotal":"59.99","listUnitPrice":"59.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002155","productName":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","projectId":"313663","promotionRulePresent":"true","quantity":"1","refundRequestStatus":"RefundSucceed","revenue":"29.99","shippingStatus":"FULFILLED","subtotal":"29.99","tax":"2.47","taxes":[{"amount":"2.47","rate":"0.0825","taxType":"US_TX"}],"total":"32.46","unitPrice":"59.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBxWrH5","refunds":[{"refundId":"1010004268283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"29.99","subtotalIncludesTax":"false","tax":"2.47","taxAmount":"2.47","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"32.46","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBxRpwf","total":"32.46"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:9Z","dateModified":"2018-01-24T15:11Z","dateSettled":"2018-01-23T21:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-23T15:9Z","invoiceDescription":"Star Wars Battlefront II: Standard Edition - PC -  NA & LATAM (Origin)","invoiceId":"1010000868283","invoiceNumber":"1010000868283","invoiceOpenAction":"SETTLE","invoiceUuid":"ee2f4452-3f12-4f6d-a4d0-9b2843346688","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"32.46","crmProductName":"star-wars-battlefront-ii","currencyName":"USD","description":"Star Wars Battlefront II: Standard Edition - PC -  NA & LATAM (Origin)","discounts":[{"amount":"30.00","discountType":"OFFER","promotionRuleId":"Origin.PRO.50.0001749","rate":"0.5001"}],"financeId":"1049470","Id":"1010000668283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010000668283","itemType":"SALES","listSubtotal":"59.99","listUnitPrice":"59.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002148","productName":"Star Wars Battlefront II: Standard Edition - PC -  NA & LATAM (Origin)","projectId":"313552","promotionRulePresent":"true","quantity":"1","refundRequestStatus":"RefundSucceed","revenue":"29.99","shippingStatus":"FULFILLED","subtotal":"29.99","tax":"2.47","taxes":[{"amount":"2.47","rate":"0.0825","taxType":"US_TX"}],"total":"32.46","unitPrice":"59.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBxRpwf","refunds":[{"refundId":"1010003868283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"29.99","subtotalIncludesTax":"false","tax":"2.47","taxAmount":"2.47","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"32.46","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBxMnlp","total":"25.97"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-23T15:8Z","dateModified":"2018-01-24T15:9Z","dateSettled":"2018-01-23T21:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-23T15:8Z","invoiceDescription":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","invoiceId":"1010000068283","invoiceNumber":"1010000068283","invoiceOpenAction":"SETTLE","invoiceUuid":"54b95842-3646-47b4-a902-6657422ccca4","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"25.97","crmProductName":"battlefield-1","currencyName":"USD","description":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","discounts":[{"amount":"36.00","discountType":"OFFER","promotionRuleId":"Origin.PRO.50.0001752","rate":"0.6001"}],"financeId":"1051827","Id":"1010000068283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010000068283","itemType":"SALES","listSubtotal":"59.99","listUnitPrice":"59.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002321","productName":"Battlefield 1 Revolution - PC - RoW (Origin/3PDD)","projectId":"314478","promotionRulePresent":"true","quantity":"1","refundRequestStatus":"RefundSucceed","revenue":"23.99","shippingStatus":"FULFILLED","subtotal":"23.99","tax":"1.98","taxes":[{"amount":"1.98","rate":"0.0825","taxType":"US_TX"}],"total":"25.97","unitPrice":"59.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBxMnlp","refunds":[{"refundId":"1010003468283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"23.99","subtotalIncludesTax":"false","tax":"1.98","taxAmount":"1.98","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"25.97","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBLmuAb","total":"42.17"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-18T11:13Z","dateModified":"2018-01-19T18:0Z","invoiceDate":"2018-01-18T11:13Z","invoiceDescription":"The Sims 4 Cats and Dogs - PC/Mac - WW (Origin/3PDD) ","invoiceId":"1010603368283","invoiceNumber":"1010603368283","invoiceOpenAction":"SETTLE","invoiceUuid":"fd4f1e6b-b4cd-453b-ac96-74d2e3c9ab89","isGift":"false","lineItems":[{"amount":"42.17","crmProductName":"the-sims-4","currencyName":"USD","description":"The Sims 4 Cats and Dogs - PC/Mac - WW (Origin/3PDD) ","discounts":[],"financeId":"1027372","Id":"1010228968283","isMVPLineItem":"false","itemId":"1010228968283","itemType":"REFUND","platform":"MAC/PCWIN","productCatalog":"CATALOG","productId":"SIMS4.OFF.SOLP.0x000000000002714B","productName":"The Sims 4 Cats and Dogs - PC/Mac - WW (Origin/3PDD) ","projectId":"310647","quantity":"1","subtotal":"38.96","tax":"3.21","taxes":[{"amount":"3.21","rate":"0.0825","taxType":"US_TX"}],"total":"42.17","unitPrice":"38.96"}],"originalInvoiceId":"1010600168283","provider":"CHASE","providerReference":"hBLmuAb","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"38.96","tax":"3.21","taxAmount":"3.21","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"42.17","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBLrwL1","total":"35.99"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-18T11:12Z","dateModified":"2018-01-19T18:0Z","invoiceDate":"2018-01-18T11:12Z","invoiceDescription":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","invoiceId":"1010602968283","invoiceNumber":"1010602968283","invoiceOpenAction":"SETTLE","invoiceUuid":"83caf4c2-2204-4e58-b1da-36ed9063cc83","isGift":"false","lineItems":[{"amount":"35.99","crmProductName":"need-for-speed-payback","currencyName":"USD","description":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","discounts":[],"financeId":"1049070","Id":"1010228368283","isMVPLineItem":"false","itemId":"1010228368283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002155","productName":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","projectId":"313663","quantity":"1","subtotal":"35.99","tax":"2.74","taxes":[{"amount":"2.74","rate":"0.0825","taxType":"US_TX"}],"total":"35.99","unitPrice":"35.99"}],"originalInvoiceId":"1010600968283","provider":"CHASE","providerReference":"hBLrwL1","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"35.99","tax":"2.74","taxAmount":"2.74","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"35.99","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBLu2Qr","total":"51.95"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-18T11:0Z","dateModified":"2018-01-19T4:33Z","dateSettled":"2018-01-18T17:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-18T11:0Z","invoiceDescription":"FIFA 18 Ronaldo Edition - PC - NA + LATAM (Origin)","invoiceId":"1010601768283","invoiceNumber":"1010601768283","invoiceOpenAction":"SETTLE","invoiceUuid":"612f7abd-4088-41c1-84b6-aa4d901b9405","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"51.95","crmProductName":"fifa-18","currencyName":"USD","description":"FIFA 18 Ronaldo Edition - PC - NA + LATAM (Origin)","discounts":[{"amount":"32.00","discountType":"OFFER","promotionRuleId":"Origin.PRO.50.0001748","rate":"0.4001"}],"financeId":"1049789","fulfillment":[{"entitlementId":"1000222568283"},{"entitlementId":"1000222768283"},{"entitlementId":"1000222368283"}],"Id":"1010227568283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010227568283","itemType":"SALES","listSubtotal":"79.99","listUnitPrice":"79.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0001997","productName":"FIFA 18 Ronaldo Edition - PC - NA + LATAM (Origin)","projectId":"315564","promotionRulePresent":"true","quantity":"1","revenue":"47.99","shippingStatus":"FULFILLED","subtotal":"47.99","tax":"3.96","taxes":[{"amount":"3.96","rate":"0.0825","taxType":"US_TX"}],"total":"51.95","unitPrice":"79.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBLu2Qr","region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"47.99","subtotalIncludesTax":"false","tax":"3.96","taxAmount":"3.96","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"51.95","transactionType":"DEBIT","userId":"1000199568283","vcFundingLinkCreditInvoiceId":"1010602168283","vcFundingLinkDebitInvoiceId":"1010601768283","vcFundingLinkId":"1010602368283","zipcode":"78703"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBLp0FB","total":"35.99"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-18T10:57Z","dateModified":"2018-01-19T4:33Z","dateSettled":"2018-01-18T17:30Z","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-18T10:57Z","invoiceDescription":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","invoiceId":"1010600968283","invoiceNumber":"1010600968283","invoiceOpenAction":"SETTLE","invoiceUuid":"81ee050d-6d4b-48f4-9f22-5a038a7f8f15","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"35.99","crmProductName":"need-for-speed-payback","currencyName":"USD","description":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","discounts":[{"amount":"24.00","discountType":"OFFER","promotionRuleId":"Origin.PRO.50.0001747","rate":"0.4001"}],"financeId":"1049070","Id":"1010227168283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010227168283","itemType":"SALES","listSubtotal":"59.99","listUnitPrice":"59.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0002155","productName":"Need for Speed Payback Standard Edition - PC - APO/LATAM (Origin)","projectId":"313663","promotionRulePresent":"true","quantity":"1","revenue":"35.99","shippingStatus":"FULFILLED","subtotal":"35.99","total":"35.99","unitPrice":"59.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBLp0FB","refunds":[{"refundId":"1010602968283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"35.99","taxStatus":"FAILED","taxStrategy":"CHARGE","total":"35.99","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBLjYuL","total":"43.29"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-18T10:49Z","dateModified":"2018-01-19T4:33Z","dateSettled":"2018-01-18T17:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-18T10:49Z","invoiceDescription":"The Sims 4 Cats and Dogs - PC/Mac - WW (Origin/3PDD) ","invoiceId":"1010600168283","invoiceNumber":"1010600168283","invoiceOpenAction":"SETTLE","invoiceUuid":"725613c5-28ef-481d-a612-75d171fcf5e3","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"43.29","crmProductName":"the-sims-4","currencyName":"USD","description":"The Sims 4 Cats and Dogs - PC/Mac - WW (Origin/3PDD) ","discounts":[],"financeId":"1027372","fulfillment":[{"entitlementId":"1000221568283"}],"Id":"1010226768283","isMVPLineItem":"false","isRefundAcceptable":"true","itemId":"1010226768283","itemType":"SALES","listSubtotal":"39.99","listUnitPrice":"39.99","platform":"MAC/PCWIN","productCatalog":"CATALOG","productId":"SIMS4.OFF.SOLP.0x000000000002714B","productName":"The Sims 4 Cats and Dogs - PC/Mac - WW (Origin/3PDD) ","projectId":"310647","quantity":"1","revenue":"39.99","shippingStatus":"FULFILLED","subtotal":"39.99","tax":"3.30","taxes":[{"amount":"3.30","rate":"0.0825","taxType":"US_TX"}],"total":"43.29","unitPrice":"39.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBLjYuL","refunds":[{"refundId":"1010603368283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"39.99","subtotalIncludesTax":"false","tax":"3.30","taxAmount":"3.30","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"43.29","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBJNZer","total":"21.09"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-15T14:34Z","dateModified":"2018-01-16T18:0Z","invoiceDate":"2018-01-15T14:34Z","invoiceDescription":"Dragon Age: Inquisition Standard Edition - PCDD - ROW (Origin)","invoiceId":"1010576568283","invoiceNumber":"1010576568283","invoiceOpenAction":"SETTLE","invoiceUuid":"f686508c-ec7c-4512-8c3b-052e1146f063","isGift":"false","lineItems":[{"amount":"21.09","crmProductName":"dragon-age-inquisition","currencyName":"USD","description":"Dragon Age: Inquisition Standard Edition - PCDD - ROW (Origin)","discounts":[],"financeId":"1000659","Id":"1010226368283","isMVPLineItem":"false","itemId":"1010226368283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"OFB-EAST:51937","productName":"Dragon Age: Inquisition Standard Edition - PCDD - ROW (Origin)","projectId":"306008","quantity":"1","subtotal":"19.48","tax":"1.61","taxes":[{"amount":"1.61","rate":"0.0825","taxType":"US_TX"}],"total":"21.09","unitPrice":"19.48"}],"originalInvoiceId":"1010573968283","provider":"CHASE","providerReference":"hBJNZer","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"19.48","tax":"1.61","taxAmount":"1.61","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"21.09","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBJIX3B","total":"21.64"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-15T14:33Z","dateModified":"2018-01-16T18:0Z","invoiceDate":"2018-01-15T14:33Z","invoiceDescription":"Plants vs. Zombies Garden Warfare 2 Standard Edition - PCDD - WW (Origin.com)","invoiceId":"1010576168283","invoiceNumber":"1010576168283","invoiceOpenAction":"SETTLE","invoiceUuid":"5450f05b-2acb-47b2-9f38-a0552f68a7c7","isGift":"false","lineItems":[{"amount":"21.64","crmProductName":"plants-vs-zombies-garden-warfare-2","currencyName":"USD","description":"Plants vs. Zombies Garden Warfare 2 Standard Edition - PCDD - WW (Origin.com)","discounts":[],"financeId":"1026482","Id":"1010225768283","isMVPLineItem":"false","itemId":"1010225768283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0000786","productName":"Plants vs. Zombies Garden Warfare 2 Standard Edition - PCDD - WW (Origin.com)","projectId":"310695","quantity":"1","subtotal":"21.64","tax":"1.65","taxes":[{"amount":"1.65","rate":"0.0825","taxType":"US_TX"}],"total":"21.64","unitPrice":"21.64"}],"originalInvoiceId":"1010573168283","provider":"CHASE","providerReference":"hBJIX3B","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"21.64","tax":"1.65","taxAmount":"1.65","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"21.64","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBJT1ph","total":"19.48"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-15T14:32Z","dateModified":"2018-01-16T18:0Z","invoiceDate":"2018-01-15T14:32Z","invoiceDescription":"Battlefield 4 Standard Edition - PC - ROW (Origin/ODC/3PDD)","invoiceId":"1010575968283","invoiceNumber":"1010575968283","invoiceOpenAction":"SETTLE","invoiceUuid":"4e8fcd12-e992-408e-9560-3c131f1442fb","isGift":"false","lineItems":[{"amount":"19.48","crmProductName":"battlefield-4","currencyName":"USD","description":"Battlefield 4 Standard Edition - PC - ROW (Origin/ODC/3PDD)","discounts":[],"financeId":"1007968","Id":"1010225368283","isMVPLineItem":"false","itemId":"1010225368283","itemType":"REFUND","platform":"PCWIN","productCatalog":"CATALOG","productId":"OFB-EAST:109546867","productName":"Battlefield 4 Standard Edition - PC - ROW (Origin/ODC/3PDD)","projectId":"302124","quantity":"1","subtotal":"19.48","tax":"1.48","taxes":[{"amount":"1.48","rate":"0.0825","taxType":"US_TX"}],"total":"19.48","unitPrice":"19.48"}],"originalInvoiceId":"1010574768283","provider":"CHASE","providerReference":"hBJT1ph","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"PENDING_ACTION","subtotal":"19.48","tax":"1.48","taxAmount":"1.48","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"19.48","transactionType":"REFUND","userId":"1000199568283"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBJQvjR","total":"21.64"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-15T14:26Z","dateModified":"2018-01-16T4:31Z","dateSettled":"2018-01-15T21:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-15T14:26Z","invoiceDescription":"Battlefield 4 Standard Edition - PC - ROW (Origin/ODC/3PDD)","invoiceId":"1010574768283","invoiceNumber":"1010574768283","invoiceOpenAction":"SETTLE","invoiceUuid":"c2a05ca2-9a61-4e12-a478-0ec778aca317","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"21.64","crmProductName":"battlefield-4","currencyName":"USD","description":"Battlefield 4 Standard Edition - PC - ROW (Origin/ODC/3PDD)","discounts":[],"financeId":"1007968","fulfillment":[{"entitlementId":"1000220968283"},{"entitlementId":"1000221168283"},{"entitlementId":"1000220768283"},{}],"Id":"1010224568283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010224568283","itemType":"SALES","listSubtotal":"19.99","listUnitPrice":"19.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"OFB-EAST:109546867","productName":"Battlefield 4 Standard Edition - PC - ROW (Origin/ODC/3PDD)","projectId":"302124","quantity":"1","revenue":"19.99","shippingStatus":"FULFILLED","subtotal":"19.99","tax":"1.65","taxes":[{"amount":"1.65","rate":"0.0825","taxType":"US_TX"}],"total":"21.64","unitPrice":"19.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBJQvjR","refunds":[{"refundId":"1010575968283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"19.99","subtotalIncludesTax":"false","tax":"1.65","taxAmount":"1.65","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"21.64","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBJGqYb","total":"21.64"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-15T14:25Z","dateModified":"2018-01-16T4:31Z","dateSettled":"2018-01-15T21:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-15T14:25Z","invoiceDescription":"Plants vs. Zombies Garden Warfare 2 Standard Edition - PCDD - WW (Origin.com)","invoiceId":"1010573168283","invoiceNumber":"1010573168283","invoiceOpenAction":"SETTLE","invoiceUuid":"01f8cf26-4ebc-4482-bd93-f5b07c7204f1","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"21.64","crmProductName":"plants-vs-zombies-garden-warfare-2","currencyName":"USD","description":"Plants vs. Zombies Garden Warfare 2 Standard Edition - PCDD - WW (Origin.com)","discounts":[],"financeId":"1026482","Id":"1010223768283","isMVPLineItem":"true","isMVPRefundable":"false","isRefundAcceptable":"true","itemId":"1010223768283","itemType":"SALES","listSubtotal":"19.99","listUnitPrice":"19.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"Origin.OFR.50.0000786","productName":"Plants vs. Zombies Garden Warfare 2 Standard Edition - PCDD - WW (Origin.com)","projectId":"310695","quantity":"1","revenue":"19.99","shippingStatus":"FULFILLED","subtotal":"19.99","tax":"1.65","taxes":[{"amount":"1.65","rate":"0.0825","taxType":"US_TX"}],"total":"21.64","unitPrice":"19.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBJGqYb","refunds":[{"refundId":"1010576168283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"19.99","subtotalIncludesTax":"false","tax":"1.65","taxAmount":"1.65","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"21.64","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"},{"billingAccountId":"1010140768283","city":"Austin","country":"US","creditCardTransaction":{"accountId":"1010140768283","provider":"CHASE","providerReference":"hBJLt91","total":"21.64"},"currencyName":"USD","currencySymbol":"$","dateCreated":"2018-01-15T14:25Z","dateModified":"2018-01-16T4:31Z","dateSettled":"2018-01-15T21:30Z","displayTax":"true","fraudReviewDecision":"APPROVED","invoiceDate":"2018-01-15T14:25Z","invoiceDescription":"Dragon Age: Inquisition Standard Edition - PCDD - ROW (Origin)","invoiceId":"1010573968283","invoiceNumber":"1010573968283","invoiceOpenAction":"SETTLE","invoiceUuid":"e6149688-8678-42a8-8175-271f786192ae","ipAddress":"159.153.130.10","isGift":"false","isRefundable":"true","lineItems":[{"amount":"21.64","crmProductName":"dragon-age-inquisition","currencyName":"USD","description":"Dragon Age: Inquisition Standard Edition - PCDD - ROW (Origin)","discounts":[],"financeId":"1000659","fulfillment":[{"entitlementId":"1000220568283"},{"entitlementId":"1000220368283"},{}],"Id":"1010224168283","isMVPLineItem":"false","isRefundAcceptable":"true","itemId":"1010224168283","itemType":"SALES","listSubtotal":"19.99","listUnitPrice":"19.99","platform":"PCWIN","productCatalog":"CATALOG","productId":"OFB-EAST:51937","productName":"Dragon Age: Inquisition Standard Edition - PCDD - ROW (Origin)","projectId":"306008","quantity":"1","revenue":"19.99","shippingStatus":"FULFILLED","subtotal":"19.99","tax":"1.65","taxes":[{"amount":"1.65","rate":"0.0825","taxType":"US_TX"}],"total":"21.64","unitPrice":"19.99"}],"locale":"en_US","provider":"CHASE","providerReference":"hBJLt91","refunds":[{"refundId":"1010576568283"}],"region":"Texas","shippingAddressId":"1000569168283","source":"EADP_CART_INVOICE","status":"Completed","statusReason":"COMPLETED","subtotal":"19.99","subtotalIncludesTax":"false","tax":"1.65","taxAmount":"1.65","taxStatus":"TAXED","taxStrategy":"CHARGE","total":"21.64","transactionType":"DEBIT","userId":"1000199568283","zipcode":"78703"}]);
        return this.serverAction(action, component)
        .then($A.getCallback(function(data){
            component.set("v.isInvoiceLoading", false);
            data = self.associateRefundInvoices(data);
            component.set("v.invoicesRaw", data || []);
            return data;
        })).catch($A.getCallback(function(err){
            component.set("v.isInvoiceLoading", false);
            throw err;
        }));
    },
    associateRefundInvoices: function(invoices){
        var duplicates = [];
        var data = invoices.map(function(_invoice, _index, _invoices) {
            if(Array.isArray(_invoice.refunds)) {
                _invoice.refunds = _invoice.refunds.map(function(_refund) {
                    duplicates.push(_refund.refundId);
                    return Object.assign({}, _refund, _invoices.find((i)=> i.invoiceId==_refund.refundId));
                })
            }
            return _invoice;
        }).filter((_invoice)=> !duplicates.includes(_invoice.invoiceId));
        return data;
    },
    fetchInvoicesCount : function(component) {
        const action = component.get("c.getInvoicesCountByUserId");
        
        action.setParams({
            strCustomerId: component.get("v.nucleusId"), 
            isUnassociated : component.get("v.isOrfanSearch"),
            strPurchaseType : component.get("v.invoiceType"),
            strStartDate: component.get("v.startDate"),
            strEndDate: component.get("v.endDate")
        });
        
        return this.serverAction(action, component)
        .then($A.getCallback(function(data){
            component.set("v.totalInvoiceCount", data || 0);
            return data;
        }));          
        //return Promise.resolve("63");
    },
    serverAction : function(action, component) {
        const self = this;
        return new Promise(function(resolve, reject) {
            action.setCallback(self, function(response){
                const state = response.getState();                
                if(state == 'SUCCESS'){
                    return resolve.call(this, response.getReturnValue());
                }
                else if(state == 'ERROR'){
                    Util.handleErrors(component, response);
                    return reject.call(this, response);
                }
            });            
            $A.enqueueAction(action);
        });
    },
    refreshInvoices : function(component) {
        component.set("v.isInvoiceLoading", true);
        Promise.all([
            this.fetchInvoices(component), 
            this.fetchInvoicesCount(component)
        ])
        .then($A.getCallback(function(data){
            component.set("v.isLoading", false);    
        })).catch($A.getCallback(function(response){
            component.set("v.isLoading", false);            
        })); 
    }
})